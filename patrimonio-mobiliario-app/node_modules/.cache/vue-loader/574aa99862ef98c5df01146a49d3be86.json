{"remainingRequest":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/src/views/components/modal/incorporacao/adicionaritem/itemincorporacao/edicao/DadosGeraisDoItemModal.vue?vue&type=style&index=0&id=33237747&scoped=true&lang=stylus&","dependencies":[{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/src/views/components/modal/incorporacao/adicionaritem/itemincorporacao/edicao/DadosGeraisDoItemModal.vue","mtime":1617028549267},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/stylus-loader/index.js","mtime":1519606876000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.close__button::before\n    background: transparent\n\n.acoes\n    height 100%\n    padding 0px 20px 15px\n\n.styleHeader\n    font-size 17px\n\n.styleHeader span\n    font-weight bold\n\n.v-dialog:not(.v-dialog--fullscreen)\n    max-height 100% !important\n",{"version":3,"sources":["DadosGeraisDoItemModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiOA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA","file":"DadosGeraisDoItemModal.vue","sourceRoot":"src/views/components/modal/incorporacao/adicionaritem/itemincorporacao/edicao","sourcesContent":["<template>\n    <div>\n        <subTitle :value=\"dadosDeEntrada\"/>\n        <v-divider></v-divider>\n        <DadosGeraisDoItemModalFormulario\n            :dadosDeEntrada=\"dadosDeEntrada\"\n            :naturezasDespesa=\"naturezasDespesa\"\n            :estadosConservacao=\"estadosConservacao\"\n            :anoFabricacaoModelo=\"anoFabricacaoModelo\"\n            :naturezaDespesaInativo=\"naturezaDespesaInativo\"\n            :apresentaTooltipImagem=\"apresentaTooltipImagem\"\n            :errorObrigatoriedadeAnexo=\"errorObrigatoriedadeAnexo\"\n            :errorTamanhoExcedido=\"errorTamanhoExcedido\"\n            @editarItem=\"salvarDadosGerais\"\n            @salvarAnexo=\"tratarEventoSalvarAnexo\"\n            @bloquearPasso3=\"liberarContinuar\"\n        />\n    </div>\n</template>\n\n\n<script>\n    import DadosGeraisDoItemModalFormulario from './DadosGeraisDoItemModalFormulario'\n    import DadosGeraisDoitemModalSubTitle from './DadosGeraisDoItemModalSubTitle'\n    import {actionTypes, mutationTypes} from '@/core/constants'\n    import {mapActions, mapMutations} from 'vuex'\n    import AzHasPermissions from '@azinformatica/loki/src/utils/AzHasPermissions'\n\n    export default {\n        name: 'DadosGeraisDoItemModal',\n        components: {\n            DadosGeraisDoItemModalFormulario,\n            subTitle: DadosGeraisDoitemModalSubTitle,\n        },\n        data() {\n            return {\n                camposObrigatoriosNaoPreenchidos: true,\n                dialog: false,\n                dadosDeEntrada: {\n                    default: {}\n                },\n                itemIncorporacaoId: null,\n                incorporacaoId: null,\n                naturezasDespesa: [],\n                estadosConservacao: [],\n                anoFabricacaoModelo: [],\n                naturezaDespesaInativo: false,\n                apresentaTooltipImagem: false,\n                errorObrigatoriedadeAnexo: 0,\n                errorTamanhoExcedido: 0,\n            }\n        },\n        async mounted() {\n            this.geraAnoModeloFabricacao()\n            this.setItemIncorporacaoId()\n            this.setIncorporacaoId()\n            if (!this.verificaPermissaoEdicao()) {\n                await this. etapaDoisVisualizacao()\n            }\n            await this.buscarDadosGeraisItemIncorporacao()\n            await this.buscarNaturezasDespesa()\n            await this.buscarTodosEstadosConservacao()\n            this.trataSeNaturezaDespesaInativo()\n        },\n        methods: {\n            ...mapActions([\n                actionTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.IMAGEM.UPLOAD,\n                actionTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.BUSCAR_ITEM_INCORPORACAO,\n                actionTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.EDITAR_ITEM_INCORPORACAO,\n                actionTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.ESTADO_CONSERVACAO.BUSCAR_ESTADOS_CONSERVACAO\n            ]),\n            ...mapMutations([\n                mutationTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.DESATIVAR_SALVAMENTO_AUTOMATICO,\n                mutationTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.SET_INCORPORACAO_ITEM\n            ]),\n            async salvarDadosGerais(novoItem) {\n                this.desabilitarLoadingGlobal()\n                if(novoItem.naturezaDespesa && typeof novoItem.naturezaDespesa.id !== 'undefined'){\n                    novoItem.naturezaDespesa = novoItem.naturezaDespesa.id\n                }\n                this.dadosDeEntrada = novoItem\n                this.dadosDeEntrada.idIncorporacao = this.incorporacaoId\n                this.setIncorporacaoItem(this.dadosDeEntrada)\n\n                await this.tratarEventoUploadImagem(novoItem)\n                const {contaContabil, tipoBem, naturezaDespesa} = await this.editarItemIncorporacao(this.dadosDeEntrada)\n                this.dadosDeEntrada.contaContabil = contaContabil\n                this.dadosDeEntrada.tipoBem = tipoBem\n                this.dadosDeEntrada.naturezaDespesa = naturezaDespesa\n                this.trataSeNaturezaDespesaInativo()\n            },\n            async tratarEventoSalvarAnexo(novoItem) {\n                if(novoItem && novoItem.uriImagem) {\n                    if (!this.extensaoArquivoValida(novoItem.uriImagem)) {\n                        this.mostrarNotificacaoErro(\n                            'Extensão do arquivo inválida. Envie arquivos nos seguintes formatos .jpeg .jpg .png'\n                        )\n                        await this.buscarDadosGeraisItemIncorporacao()\n                    } else {\n                        if (this.validarTamanhoMaximo(novoItem.uriImagem.size)) {\n                            this.errorTamanhoExcedido = 1\n                            this.dadosDeEntrada.uriImagem = await null\n                            setTimeout(() => {\n                                this.errorTamanhoExcedido = 0\n                                this.errorObrigatoriedadeAnexo = 1\n                                this.$validator._base.validateAll()\n                            }, 3000)\n                        } else {\n                            await this.salvarDadosGerais(novoItem)\n                        }\n                    }\n                }\n                this.apresentaTooltipImagem = false\n            },\n            liberarContinuar(condicao) {\n                this.camposObrigatoriosNaoPreenchidos = condicao\n                this.verificarSituacaoItemIncorporacao(condicao)\n                this.setIncorporacaoItem(this.dadosDeEntrada)\n                this.$emit('verificarContinuar', condicao)\n            },\n            async buscarNaturezasDespesa() {\n                this.desabilitarLoadingGlobal()\n                const resultado = await this.$store.dispatch(\n                    actionTypes.COMUM.BUSCAR_NATUREZAS_DESPESA,\n                    this.dadosDeEntrada.codigo\n                )\n                this.habilitarLoadingGlobal()\n                if (resultado) {\n                    if (resultado.items.length === 0) {\n                        this.mostrarNotificacaoAviso('Item sem conta contábil, natureza de despesa ou tipo ativos. Escolha outro item')\n                    }\n                    this.naturezasDespesa = resultado.items\n                    this.selecionarNaturezaDespesaCasoTenhaUmaApenas(resultado.items)\n                }\n            },\n            async buscarTodosEstadosConservacao() {\n                const {estadosConservacao} = await this.buscarEstadosConservacao()\n                this.estadosConservacao = estadosConservacao\n            },\n            selecionarNaturezaDespesaCasoTenhaUmaApenas(naturezasDespesa) {\n                if(!this.dadosDeEntrada.naturezaDespesa && naturezasDespesa.length === 1) {\n                    this.dadosDeEntrada.naturezaDespesa = naturezasDespesa[0].id\n                    this.salvarDadosGerais(this.dadosDeEntrada)\n                }\n            },\n            geraAnoModeloFabricacao() {\n                const anoMinimo = 1980\n                const anoAtual = new Date().getFullYear()\n                for (let ano = anoAtual; ano >= anoMinimo; ano--) {\n                    let anoFabricacao = parseInt(ano)\n                    let anoModeloMaior = parseInt(ano + 1)\n                    this.anoFabricacaoModelo.push(anoFabricacao + '/' + anoModeloMaior)\n                    this.anoFabricacaoModelo.push(anoFabricacao + '/' + anoFabricacao)\n                }\n            },\n            trataSeNaturezaDespesaInativo(){\n                if(this.dadosDeEntrada && this.dadosDeEntrada.naturezaDespesa && this.dadosDeEntrada.naturezaDespesa.situacao === 'INATIVO'){\n                    this.dadosDeEntrada.naturezaDespesa.disabled = true\n                    this.naturezaDespesaInativo = true\n                    this.naturezasDespesa.unshift(this.dadosDeEntrada.naturezaDespesa)\n                    this.dadosDeEntrada.naturezaDespesa = this.dadosDeEntrada.naturezaDespesa.id\n                }else{\n                    this.naturezaDespesaInativo = false\n                }\n            },\n            extensaoArquivoValida(arquivo) {\n                const formatosAceitos = [\n                    'image/png',\n                    'image/jpg',\n                    'image/jpeg'\n                ]\n\n                return formatosAceitos.includes(arquivo.type)\n            },\n            validarTamanhoMaximo(tamanhoAnexo) {\n                return tamanhoAnexo >= 15116247\n            },\n            verificarSituacaoItemIncorporacao(estaInvalido){\n                if(estaInvalido) {\n                    this.dadosDeEntrada.situacao = 'EM_ELABORACAO'\n                }\n            },\n            async tratarEventoUploadImagem(itemAnexo) {\n                this.desabilitarLoadingGlobal()\n                if (itemAnexo.uriImagem && typeof itemAnexo.uriImagem == 'object') {\n                    this.dadosDeEntrada.uriImagem = await this.uploadImagem(itemAnexo)\n                }\n                this.habilitarLoadingGlobal()\n            },\n            setItemIncorporacaoId(){\n                if (this.$route.params.itemIncorporacaoId) {\n                    this.itemIncorporacaoId = this.$route.params.itemIncorporacaoId\n                }\n            },\n            setIncorporacaoId(){\n                if(this.$route.params.incorporacaoId){\n                    this.incorporacaoId = this.$route.params.incorporacaoId\n                }\n            },\n            async buscarDadosGeraisItemIncorporacao() {\n                this.desabilitarLoadingGlobal()\n                const resultado = await this.buscarItemIncorporacao({idItem: this.itemIncorporacaoId, idIncorporacao: this.incorporacaoId})\n                this.habilitarLoadingGlobal()\n                this.dadosDeEntrada = resultado\n                this.dadosDeEntrada.valorTotalAnterior = resultado.valorTotal\n                this.dadosDeEntrada.numeracaoPatrimonial = 'AUTOMATICA'\n                this.setIncorporacaoItem(this.dadosDeEntrada)\n            },\n            etapaDoisVisualizacao(){\n                this.$router.push({\n                    name: 'VisualizacaoDadosGerais',\n                    itemIncorporacaoId: this.itemIncorporacaoId,\n                    incorporacaoId: this.incorporacaoId\n                })\n            },\n            verificaPermissaoEdicao() {\n                return AzHasPermissions(this.$store.state.loki.user.authorities, [\n                    'Mobiliario.Normal',\n                ])\n            },\n        },\n    }\n</script>\n\n<style scoped lang=\"stylus\">\n    .close__button::before\n        background: transparent\n\n    .acoes\n        height 100%\n        padding 0px 20px 15px\n\n    .styleHeader\n        font-size 17px\n\n    .styleHeader span\n        font-weight bold\n\n    .v-dialog:not(.v-dialog--fullscreen)\n        max-height 100% !important\n</style>\n"]}]}