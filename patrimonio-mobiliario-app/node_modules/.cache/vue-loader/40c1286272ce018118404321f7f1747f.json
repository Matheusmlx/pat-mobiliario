{"remainingRequest":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/src/views/components/modal/incorporacao/adicionaritem/ModalIncorporacaoItem.vue?vue&type=style&index=0&id=9adf9f74&scoped=true&lang=stylus&","dependencies":[{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/src/views/components/modal/incorporacao/adicionaritem/ModalIncorporacaoItem.vue","mtime":1614049852953},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/stylus-loader/index.js","mtime":1519606876000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/matheus/Documentos/patrimonio-mobiliario/patrimonio-mobiliario-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.etapaStyle\n    font-weight bold\n    font-size 16px\n\n.auto-save-modal\n    color white\n\n.modal-incorporacao-container\n    padding 0px !important\n    overflow-x hidden\n    height 75vh\n\n",{"version":3,"sources":["ModalIncorporacaoItem.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6RA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA","file":"ModalIncorporacaoItem.vue","sourceRoot":"src/views/components/modal/incorporacao/adicionaritem","sourcesContent":["<template>\n    <v-row justify=\"center\">\n        <v-dialog v-model=\"exibeModal\" persistent max-width=\"1100\" scrollable @keydown.esc=\"fecharModal\">\n            <v-card>\n                <v-toolbar dark color=\"primary\" class=\"styleToolBar\">\n                    <v-toolbar-title><span class=\"etapaStyle\">{{titulo}}</span></v-toolbar-title>\n                    <v-spacer/>\n                    <az-auto-save v-if=\"$store.state.itemIncorporacao.autoSave.show\" class=\"auto-save-modal\"/>\n                    <v-btn class=\"close__button\" icon @click=\"fecharModal\">\n                        <v-icon size=\"20\">close</v-icon>\n                    </v-btn>\n                </v-toolbar>\n                <v-card-text class=\"modal-incorporacao-container\">\n                    <router-view @fechar=\"fecharModal\" @verificarContinuar=\"tratarEventoVerificarContinuar\"\n                                 @trocarItem=\"tratarEventoSelecionarItem\"/>\n                </v-card-text>\n                <div>\n                    <v-divider/>\n                    <modal-incorporacao-acoes\n                        :podeContinuar=\"continuar\"\n                        @salvarNovoItem=\"tratarEventoSalvarNovoItem\"\n                        @editarItemPassoUm=\"tratarEventoEditarItemPassoUm\"\n                        @avancarEtapaDoisVisualizar=\"tratarEventoAvancarEtapaDoisVisualizar\"\n                        @avancarEtapaTres=\"tratarEventoAvancarEtapaTres\"\n                        @avancarEtapaTresVisualizar=\"tratarEventoAvancarEtapaTresVisualizar\"\n                        @voltarPassoNovo=\"tratarEventoVoltarPassoUm\"\n                        @voltarPassoUmEdicao=\"tratarEventoVoltarPassoUmEdicao\"\n                        @voltarPassoUmVisualizar=\"tratarEventoVoltarPassoUmVisualizar\"\n                        @voltarPassoDoisEdicao=\"tratarEventoVoltarPassoDoisEdicao\"\n                        @voltarPassoDoisVisualizar=\"tratarEventoVoltarPassoDoisVisualizar\"\n                        @fechar=\"fecharModal\"/>\n                </div>\n            </v-card>\n        </v-dialog>\n    </v-row>\n</template>\n<script>\n    import ModalIncorporacaoAcoes from './ModalIncorporacaoAcoes'\n    import {actionTypes, mutationTypes} from '@/core/constants'\n    import {mapActions, mapMutations, createNamespacedHelpers} from 'vuex'\n    import AzHasPermissions from '@azinformatica/loki/src/utils/AzHasPermissions'\n\n    const {mapGetters} = createNamespacedHelpers('rotulosPersonalizados')\n\n    export default {\n        name: 'ModalIncorporacaoItem',\n        components: {ModalIncorporacaoAcoes},\n        data() {\n            return {\n                exibeModal: true,\n                etapa: '',\n                descricaoEtapa: '',\n                continuar: false,\n                incorporacaoItem: {},\n                incorporacaoId: null,\n                itemIncorporacaoId: null,\n                manteveItemCatalogo: true,\n            }\n        },\n        async mounted() {\n            await this.buscaItemIncorporacao()\n        },\n        computed: {\n            ...mapGetters([\n                'getItemIncorporacaoValidado',\n            ]),\n            titulo() {\n                return this.$route.meta.modal.title\n            },\n        },\n        watch: {\n            $route: {\n                immediate: true,\n                handler: function (newVal) {\n                    this.exibirModal = newVal.meta && newVal.meta.modal.showModal\n                }\n            }\n        },\n        methods: {\n            ...mapMutations([\n                mutationTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.DESATIVAR_SALVAMENTO_AUTOMATICO\n            ]),\n            ...mapActions([\n                actionTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.CADASTRAR_ITEM_INCORPORACAO,\n                actionTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.EDITAR_ITEM_INCORPORACAO,\n                actionTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.DELETAR_ITEM_INCORPORACAO,\n                actionTypes.PATRIMONIO.INCORPORACAO.INCORPORACAO_ITEM.BUSCAR_ITEM_INCORPORACAO,\n                actionTypes.PATRIMONIO.CADASTRAR_PATRIMONIO\n            ]),\n            setarDadosParaEdicao(item) {\n                this.incorporacaoItem.codigo = item.codigo\n                this.incorporacaoItem.descricao = item.descricao\n                this.incorporacaoItem.idIncorporacao = this.incorporacaoId\n                if (this.incorporacaoItem.naturezaDespesa && typeof this.incorporacaoItem.naturezaDespesa.id !== 'undefined') {\n                    this.incorporacaoItem.naturezaDespesa = this.incorporacaoItem.naturezaDespesa.id\n                }\n            },\n            async buscaItemIncorporacao() {\n                this.setIncorporacaoId()\n                this.setItemIncorporacaoId()\n                if (this.itemIncorporacaoId && this.incorporacaoId) {\n                    this.incorporacaoItem = await this.buscarItemIncorporacao({\n                        idItem: this.itemIncorporacaoId,\n                        idIncorporacao: this.incorporacaoId\n                    })\n                }\n            },\n            async cadastraPatrimonio() {\n                let item = this.$store.state.itemIncorporacao.dadosGerais\n\n                const patrimonio = {\n                    quantidade: item.quantidade,\n                    valorTotal: item.valorTotal,\n                    valorTotalAnterior: item.valorTotalAnterior,\n                    contaContabilId: item.contaContabil.id,\n                    itemIncorporacaoId: this.$route.params.itemIncorporacaoId\n                }\n\n                await this.cadastrarPatrimonio(patrimonio)\n            },\n            async fecharModal() {\n                await this.tratarEventoFinalizarItemIncorporacao()\n                this.desativarSalvamentoAutomatico()\n                this.exibeModal = false\n                if(this.verificaPermissaoEdicao()){\n                    await this.$router.push({ name: 'ItensIncorporacaoListagem', params: {incorporacaoId: this.incorporacaoId}})\n                } else{\n                    await this.$router.push({ name: 'VisualizarItensIncorporacao', params: {incorporacaoId: this.incorporacaoId}})\n                }\n            },\n            setIncorporacaoId() {\n                if (this.$route.params.incorporacaoId) {\n                    this.incorporacaoId = this.$route.params.incorporacaoId\n                }\n            },\n            setItemIncorporacaoId() {\n                if (this.$route.params.itemIncorporacaoId) {\n                    this.itemIncorporacaoId = this.$route.params.itemIncorporacaoId\n                }\n            },\n            async tratarEventoAvancarEtapaTres() {\n                await this.cadastraPatrimonio()\n                this.desativarSalvamentoAutomatico()\n                await this.$router.push({\n                    name: 'IncorporacaoItemListagemPatrimonios',\n                    params: {\n                        itemIncorporacaoId: this.$route.params.itemIncorporacaoId,\n                        incorporacaoId: this.incorporacaoId\n                    }\n                })\n            },\n            tratarEventoAvancarEtapaDoisVisualizar() {\n                this.$router.push({\n                    name: 'VisualizacaoDadosGerais',\n                    params: {\n                        itemIncorporacaoId: this.$route.params.itemIncorporacaoId,\n                        incorporacaoId: this.incorporacaoId\n                    }\n                })\n            },\n            tratarEventoAvancarEtapaTresVisualizar() {\n                this.$router.push({\n                    name: 'IncorporacaoItemListagemPatrimoniosVisualizacao',\n                    params: {incorporacaoId: this.incorporacaoId}\n                })\n            },\n            async tratarEventoSelecionarItem() {\n                let item = this.$store.state.itemIncorporacao.dadosGerais\n                if (this.verificarSeHouveTrocaDeItem(item) && this.manteveItemCatalogo) {\n                    this.mostrarNotificacaoAviso('Os campos preenchidos na \"Etapa 2 - Dados gerais do item compra\" serão resetados.')\n                    this.manteveItemCatalogo = false\n                }\n            },\n            async tratarEventoEditarItemPassoUm() {\n                let item = this.$store.state.itemIncorporacao.dadosGerais\n                if (this.verificarSeHouveTrocaDeItem(item)) {\n                    const dados = {idIncorporacao: this.incorporacaoId, idItem: this.incorporacaoItem.id}\n                    await this.deletarItemIncorporacao(dados)\n                    await this.tratarEventoSalvarNovoItem()\n                    this.setItemIncorporacaoId()\n                } else {\n                    await this.$router.push({\n                        name: 'DadosGeraisDoItemModal',\n                        params: {itemIncorporacaoId: this.itemIncorporacaoId},\n                    })\n                }\n            },\n            verificarSeHouveTrocaDeItem(item) {\n                return this.incorporacaoItem.codigo !== item.codigo\n            },\n            async tratarEventoFinalizarItemIncorporacao() {\n                if (this.$route.meta.modal.visualizacao || this.$route.name !== 'IncorporacaoItemListagemPatrimonios') return\n                if (await this.verificarItemIncorporacaoValidado()) {\n                    if (this.incorporacaoItem.situacao === 'FINALIZADO') return\n                    this.setarDadosParaEdicao(this.incorporacaoItem)\n                    this.incorporacaoItem.situacao = 'FINALIZADO'\n                    await this.editarItemIncorporacao(this.incorporacaoItem)\n                }\n            },\n            async tratarEventoSalvarNovoItem() {\n                this.desabilitarLoadingGlobal()\n                let item = this.$store.state.itemIncorporacao.dadosGerais\n                item = {...item, idIncorporacao: this.incorporacaoId}\n                const retorno = await this.cadastrarItemIncorporacao(item)\n\n                if (retorno.id) {\n                    await this.$router.push({\n                        name: 'DadosGeraisDoItemModal',\n                        params: {itemIncorporacaoId: retorno.id},\n                    })\n                }\n                this.habilitarLoadingGlobal()\n            },\n            tratarEventoVerificarContinuar(condicao) {\n                if (condicao !== undefined) {\n                    this.continuar = condicao\n                } else {\n                    this.continuar = true\n                }\n            },\n            tratarEventoVoltarPassoUm() {\n                this.desativarSalvamentoAutomatico()\n                if (this.verificaPermissaoEdicao()) {\n                    this.$router.push({\n                        name: 'ItensCatalogoModalNovo',\n                        params: {incorporacaoId: this.incorporacaoId}\n                    })\n                } else {\n                    this.$router.push({\n                        name: 'ItensCatalogoModalVisualizacao',\n                        params: {incorporacaoId: this.incorporacaoId}\n                    })\n                }\n                this.continuar = false\n            },\n            async tratarEventoVoltarPassoUmEdicao() {\n                this.manteveItemCatalogo = true\n                await this.buscaItemIncorporacao()\n                this.desativarSalvamentoAutomatico()\n                await this.$router.push({\n                    name: 'ItensCatalogoModalEdicao',\n                    params: {\n                        incorporacaoId: this.incorporacaoId,\n                        itemIncorporacaoId: this.$route.params.itemIncorporacaoId\n                    }\n                })\n                this.continuar = false\n            },\n            tratarEventoVoltarPassoUmVisualizar() {\n                this.$router.push({\n                    name: 'ItensCatalogoModalVisualizacaoCadastrado',\n                    params: {itemIncorporacaoId: this.itemIncorporacaoId}\n                })\n                this.continuar = true\n            },\n            tratarEventoVoltarPassoDoisEdicao() {\n                this.desativarSalvamentoAutomatico()\n                this.$router.push({\n                    name: 'DadosGeraisDoItemModal',\n                    params: {itemIncorporacaoId: this.$route.params.itemIncorporacaoId},\n                })\n            },\n            tratarEventoVoltarPassoDoisVisualizar() {\n                this.$router.push({\n                    name: 'VisualizacaoDadosGerais',\n                    params: {itemIncorporacaoId: this.itemIncorporacaoId}\n                })\n            },\n            verificaPermissaoEdicao() {\n                return AzHasPermissions(this.$store.state.loki.user.authorities, [\n                    'Mobiliario.Normal',\n                ])\n            },\n            async verificarItemIncorporacaoValidado() {\n                await this.buscaItemIncorporacao()\n                const tipoVeiculo = (this.incorporacaoItem.tipoBem === 'VEICULO')\n                return this.getItemIncorporacaoValidado(this.incorporacaoItem, tipoVeiculo, 'ITEM_INCORPORACAO')\n            }\n\n\n        }\n    }\n</script>\n\n<style scoped lang=\"stylus\">\n    .etapaStyle\n        font-weight bold\n        font-size 16px\n\n    .auto-save-modal\n        color white\n\n    .modal-incorporacao-container\n        padding 0px !important\n        overflow-x hidden\n        height 75vh\n\n</style>\n"]}]}